<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSynth</title>
    <style>
        * {
            font-family: monospace;
            color: white;
            cursor:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg'  width='40' height='48' viewport='0 0 100 100' style='fill:black;font-size:24px;'><text y='50%'>🤔</text></svg>") 16 0,auto; /*!emojicursor.app*/
        }

        input:hover {
            cursor:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg'  width='40' height='48' viewport='0 0 100 100' style='fill:black;font-size:24px;'><text y='50%'>😀</text></svg>") 16 0,auto;
        }

        a {
            color: rgb(130, 240, 57);
        }

        body {
            background-color: black;
        }

        marquee {
            background-color: rgb(255, 71, 47);
        }

        button {
            color: black;
        }

        select {
            background-color: black;
        }

        .channel {
            display: flex;
            flex-direction: row;
            justify-content: space-evenly;
        }

        .module {
            display: flex;
            flex-direction: column;
            border: 1px solid rgb(41, 233, 41);
            margin: 3px;
            padding: 5px;
        }

    </style>
</head>
<body>
    <header>
        <marquee behavior="scroll" direction="right" class="banner" id="top-banner">
            <p>▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️▶️</p>
        </marquee>
        <nav>
            <a href="/" target="_blank">new tab</a>
            👀
            <a href="/" target="_blank">new tab</a>
            ☢️
            <a href="/" target="_blank">new tab</a>
            🛢️
            <a href="/" target="_blank">new tab</a>
            🍕
            <a href="/" target="_blank">new tab</a>
            💬
            <a href="/" target="_blank">new tab</a>
            🍻
            <a href="/" target="_blank">new tab</a>
            👁️
            <a href="/" target="_blank">new tab</a>
            💀
            <a href="/" target="_blank">new tab</a>
            💧
            <a href="/" target="_blank">new tab</a>
            🌈
            <a href="/" target="_blank">new tab</a>
            🔥
            <a href="/" target="_blank">new tab</a>
            🌲
            <a href="/" target="_blank">new tab</a>
            ⭐
            <a href="/" target="_blank">new tab</a>
            🍄
            <a href="/" target="_blank">new tab</a>
            🎸
            <a href="/" target="_blank">new tab</a>
            😈
            <a href="/" target="_blank">new tab</a>
            👽
            <a href="/" target="_blank">new tab</a>
            🔪
            <a href="/" target="_blank">new tab</a>
            ✨
            <a href="/" target="_blank">new tab</a>
            🛀
            <a href="/" target="_blank">new tab</a>
            🪐
            <a href="/" target="_blank">new tab</a>
            🌑
            <a href="/" target="_blank">new tab</a>
            ☀️
            <a href="/" target="_blank">new tab</a>
        </nav>
    </header>

    <div class="controls">
        <div class="output channel">
            <p>1.</p>
            <div class="module volume">
                🔊
                <input class="vol" type="range" min="0" max="1" step="any" value="0">
            </div>
            <div class="module freq">
                🌊
                <input type="range" min="50" max="1000" step="any" value="500">
            </div>
            <div class="module shape">
                ⚒️
                <select class="wave-shape" name="wave-shape">
                    <option value="sine">~~~</option>
                    <option value="square">🟩</option>
                    <option value="triangle">📐</option>
                    <option value="sawtooth">🪚</option>
                </select>
            </div>
            <div class="module cut-off">
                ✂️
                <select class="filter-type" name="filter-type" value="bandpass">
                    <option value="lowpass">🪫</option>
                    <option value="highpass">🥴</option>
                    <option value="bandpass">🩹</option>
                </select>
                <input class="cut-off-freq" type="range" min="50" max="1000" step="any" value="500">
            </div>
            <div class="module pan">
                🍳
                <input type="range" min="-1" max="1" step="any" value="0">
            </div>
            <div class="module q">
                🇶
                <input type="range" min="0" max="100" step="any">
            </div>
            <div class="module shaper">
                🌊
                ⚒️
                <input type="range" class="input-1" value="-1" min="-100" max="-1" step="any">
                <input type="range" class="input-2" value="1" min="1" max="100" step="any">
            </div>
            <div class="module delay">
                🚂
                <input type="range" min="0" max="10" step="0.05">
            </div>
        </div>

        <div class="output channel">
            <p>1.</p>
            <div class="module volume">
                🔊
                <input class="vol" type="range" min="0" max="1" step="any" value="0">
            </div>
            <div class="module freq">
                🌊
                <input type="range" min="50" max="1000" step="any" value="500">
            </div>
            <div class="module shape">
                ⚒️
                <select class="wave-shape" name="wave-shape">
                    <option value="sine">~~~</option>
                    <option value="square">🟩</option>
                    <option value="triangle">📐</option>
                    <option value="sawtooth">🪚</option>
                </select>
            </div>
            <div class="module cut-off">
                ✂️
                <select class="filter-type" name="filter-type" value="bandpass">
                    <option value="lowpass">🪫</option>
                    <option value="highpass">🥴</option>
                    <option value="bandpass">🩹</option>
                </select>
                <input class="cut-off-freq" type="range" min="50" max="1000" step="any" value="500">
            </div>
            <div class="module pan">
                🍳
                <input type="range" min="-1" max="1" step="any" value="0">
            </div>
            <div class="module q">
                🇶
                <input type="range" min="0" max="100" step="any">
            </div>
            <div class="module shaper">
                🌊
                ⚒️
                <input type="range" class="input-1" value="-1" min="-100" max="-1" step="any">
                <input type="range" class="input-2" value="1" min="1" max="100" step="any">
            </div>
            <div class="module delay">
                🚂
                <input type="range" min="0" max="10" step="0.05">
            </div>
        </div>

        <div class="output channel">
            <p>2.</p>
            <div class="module volume">
                🔊
                <input class="vol" type="range" min="0" max="1" step="any" value="0">
            </div>
            <div class="module freq">
                🌊
                <input type="range" min="50" max="1000" step="any" value="500">
            </div>
            <div class="module shape">
                ⚒️
                <select class="wave-shape" name="wave-shape">
                    <option value="sine">~~~</option>
                    <option value="square">🟩</option>
                    <option value="triangle">📐</option>
                    <option value="sawtooth">🪚</option>
                </select>
            </div>
            <div class="module cut-off">
                ✂️
                <select class="filter-type" name="filter-type" value="bandpass">
                    <option value="lowpass">🪫</option>
                    <option value="highpass">🥴</option>
                    <option value="bandpass">🩹</option>
                </select>
                <input class="cut-off-freq" type="range" min="50" max="1000" step="any" value="500">
            </div>
            <div class="module pan">
                🍳
                <input type="range" min="-1" max="1" step="any" value="0">
            </div>
            <div class="module q">
                🇶
                <input type="range" min="0" max="100" step="any">
            </div>
            <div class="module shaper">
                🌊
                ⚒️
                <input type="range" class="input-1" value="-1" min="-100" max="-1" step="any">
                <input type="range" class="input-2" value="1" min="1" max="100" step="any">
            </div>
            <div class="module delay">
                🚂
                <input type="range" min="0" max="10" step="0.05">
            </div>
        </div>

        <div class="output channel">
            <p>3.</p>
            <div class="module volume">
                🔊
                <input class="vol" type="range" min="0" max="1" step="any" value="0">
            </div>
            <div class="module freq">
                🌊
                <input type="range" min="50" max="1000" step="any" value="500">
            </div>
            <div class="module shape">
                ⚒️
                <select class="wave-shape" name="wave-shape">
                    <option value="sine">~~~</option>
                    <option value="square">🟩</option>
                    <option value="triangle">📐</option>
                    <option value="sawtooth">🪚</option>
                </select>
            </div>
            <div class="module cut-off">
                ✂️
                <select class="filter-type" name="filter-type" value="bandpass">
                    <option value="lowpass">🪫</option>
                    <option value="highpass">🥴</option>
                    <option value="bandpass">🩹</option>
                </select>
                <input class="cut-off-freq" type="range" min="50" max="1000" step="any" value="500">
            </div>
            <div class="module pan">
                🍳
                <input type="range" min="-1" max="1" step="any" value="0">
            </div>
            <div class="module q">
                🇶
                <input type="range" min="0" max="100" step="any">
            </div>
            <div class="module shaper">
                🌊
                ⚒️
                <input type="range" class="input-1" value="-1" min="-100" max="-1" step="any">
                <input type="range" class="input-2" value="1" min="1" max="100" step="any">
            </div>
            <div class="module delay">
                🚂
                <input type="range" min="0" max="10" step="0.05">
            </div>
        </div>

        <div class="control channel">
            <div class="module lfo">
                🕹️
                <input type="range">
                <div class="checkboxes">
                    1.
                    <input type="checkbox" value="1" name="checkboxes">
                    2.
                    <input type="checkbox" value="2" name="checkboxes">
                    3.
                    <input type="checkbox" value="3" name="checkboxes">
                    4.
                    <input type="checkbox" value="4" name="checkboxes">
                </div>
                <select class="ctrl-param" name="ctrl-param">
                    <option value="volume">🔊</option>
                    <option value="frequency">🌊</option>
                    <option value="pan">🍳</option>
                    <option value="q">🇶</option>
                </select>
                <button class="connect">connect</button>
                <button class="disconnect">disconnect</button>
            </div>
            <div class="module lfo">
                🕹️
                <input type="range">
                <div class="checkboxes">
                    1.
                    <input type="checkbox" value="1" name="checkboxes">
                    2.
                    <input type="checkbox" value="2" name="checkboxes">
                    3.
                    <input type="checkbox" value="3" name="checkboxes">
                    4.
                    <input type="checkbox" value="4" name="checkboxes">
                </div>
                <select class="ctrl-param" name="ctrl-param">
                    <option value="volume">🔊</option>
                    <option value="frequency">🌊</option>
                    <option value="pan">🍳</option>
                    <option value="q">🇶</option>
                </select>
                <button class="connect">connect</button>
                <button class="disconnect">disconnect</button>
            </div>
            <div class="module lfo">
                🕹️
                <input type="range">
                <div class="checkboxes">
                    1.
                    <input type="checkbox" value="1" name="checkboxes">
                    2.
                    <input type="checkbox" value="2" name="checkboxes">
                    3.
                    <input type="checkbox" value="3" name="checkboxes">
                    4.
                    <input type="checkbox" value="4" name="checkboxes">
                </div>
                <select class="ctrl-param" name="ctrl-param">
                    <option value="volume">🔊</option>
                    <option value="frequency">🌊</option>
                    <option value="pan">🍳</option>
                    <option value="q">🇶</option>
                </select>
                <button class="connect">connect</button>
                <button class="disconnect">disconnect</button>
            </div>
            <div class="module lfo">
                🕹️
                <input type="range">
                <div class="checkboxes">
                    1.
                    <input type="checkbox" value="1" name="checkboxes">
                    2.
                    <input type="checkbox" value="2" name="checkboxes">
                    3.
                    <input type="checkbox" value="3" name="checkboxes">
                    4.
                    <input type="checkbox" value="4" name="checkboxes">
                </div>
                <select class="ctrl-param" name="ctrl-param">
                    <option value="volume">🔊</option>
                    <option value="frequency">🌊</option>
                    <option value="pan">🍳</option>
                    <option value="q">🇶</option>
                </select>
                <button class="connect">connect</button>
                <button class="disconnect">disconnect</button>
            </div>
            <div class="module lfo">
                🕹️
                <input type="range">
                <div class="checkboxes">
                    1.
                    <input type="checkbox" value="1" name="checkboxes">
                    2.
                    <input type="checkbox" value="2" name="checkboxes">
                    3.
                    <input type="checkbox" value="3" name="checkboxes">
                    4.
                    <input type="checkbox" value="4" name="checkboxes">
                </div>
                <select class="ctrl-param" name="ctrl-param">
                    <option value="volume">🔊</option>
                    <option value="frequency">🌊</option>
                    <option value="pan">🍳</option>
                    <option value="q">🇶</option>
                </select>
                <button class="connect">connect</button>
                <button class="disconnect">disconnect</button>
            </div>
            <div class="module lfo">
                🕹️
                <input type="range">
                <div class="checkboxes">
                    1.
                    <input type="checkbox" value="1" name="checkboxes">
                    2.
                    <input type="checkbox" value="2" name="checkboxes">
                    3.
                    <input type="checkbox" value="3" name="checkboxes">
                    4.
                    <input type="checkbox" value="4" name="checkboxes">
                </div>
                <select class="ctrl-param" name="ctrl-param">
                    <option value="volume">🔊</option>
                    <option value="frequency">🌊</option>
                    <option value="pan">🍳</option>
                    <option value="q">🇶</option>
                </select>
                <button class="connect">connect</button>
                <button class="disconnect">disconnect</button>
            </div>
            <div class="module lfo">
                🕹️
                <input type="range">
                <div class="checkboxes">
                    1.
                    <input type="checkbox" value="1" name="checkboxes">
                    2.
                    <input type="checkbox" value="2" name="checkboxes">
                    3.
                    <input type="checkbox" value="3" name="checkboxes">
                    4.
                    <input type="checkbox" value="4" name="checkboxes">
                </div>
                <select class="ctrl-param" name="ctrl-param">
                    <option value="volume">🔊</option>
                    <option value="frequency">🌊</option>
                    <option value="pan">🍳</option>
                    <option value="q">🇶</option>
                </select>
                <button class="connect">connect</button>
                <button class="disconnect">disconnect</button>
            </div>
            <div class="module lfo">
                🕹️
                <input type="range">
                <div class="checkboxes">
                    1.
                    <input type="checkbox" value="1" name="checkboxes">
                    2.
                    <input type="checkbox" value="2" name="checkboxes">
                    3.
                    <input type="checkbox" value="3" name="checkboxes">
                    4.
                    <input type="checkbox" value="4" name="checkboxes">
                </div>
                <select class="ctrl-param" name="ctrl-param">
                    <option value="volume">🔊</option>
                    <option value="frequency">🌊</option>
                    <option value="pan">🍳</option>
                    <option value="q">🇶</option>
                </select>
                <button class="connect">connect</button>
                <button class="disconnect">disconnect</button>
            </div>
            <div class="module lfo">
                🕹️
                <input type="range">
                <div class="checkboxes">
                    1.
                    <input type="checkbox" value="1" name="checkboxes">
                    2.
                    <input type="checkbox" value="2" name="checkboxes">
                    3.
                    <input type="checkbox" value="3" name="checkboxes">
                    4.
                    <input type="checkbox" value="4" name="checkboxes">
                </div>
                <select class="ctrl-param" name="ctrl-param">
                    <option value="volume">🔊</option>
                    <option value="frequency">🌊</option>
                    <option value="pan">🍳</option>
                    <option value="q">🇶</option>
                </select>
                <button class="connect">connect</button>
                <button class="disconnect">disconnect</button>
            </div>
        </div>
    </div>

    <script>
        // Banner animation
        const banners = document.getElementsByClassName('banner');
        const bannerColours = [
            'rgb(255, 47, 203)',
            'rgb(78, 47, 255)',
            'rgb(47, 255, 245)',
            'rgb(82, 255, 47)',
            'rgb(255, 234, 47)',
            'rgb(255, 147, 47)',
            'rgb(255, 71, 47)'
        ];

        for (let i = 0; i < banners.length; i++){
            let j = 0;
            setInterval(() => {
                banners[i].style.backgroundColor = bannerColours[j];
                if(j < 7){
                    j++
                } else {
                    j = 0;
                }
            }, 200);
        }

        // Audio stuff
        const ctx = new AudioContext();
        let oscillators = [];
        let gainNodes = [];
        let filters = [];
        let stereoPannerNodes = [];
        let waveShaperNodes = [];
        let delayNodes = [];

        const play = document.getElementById('top-banner');
        play.addEventListener("click", () => {
            for(let i = 0; i < 4; i++){
                oscillators[i] = ctx.createOscillator();
                oscillators[i].frequency.setValueAtTime(500, ctx.currentTime);

                gainNodes[i] = ctx.createGain();
                gainNodes[i].gain.setValueAtTime(0, ctx.currentTime);

                waveShaperNodes[i] = ctx.createWaveShaper();

                delayNodes[i] = ctx.createDelay();

                stereoPannerNodes[i] = ctx.createStereoPanner();

                filters[i] = ctx.createBiquadFilter();

                oscillators[i].connect(gainNodes[i]);
                gainNodes[i].connect(waveShaperNodes[i]);
                waveShaperNodes[i].connect(delayNodes[i]);
                delayNodes[i].connect(stereoPannerNodes[i]);
                stereoPannerNodes[i].connect(filters[i]);
                filters[i].connect(ctx.destination);
                oscillators[i].start();
            }
            play.innerHTML = "<p>⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️⏹️</p>"
        })
        
        // Direct Oscillator Controls
        const volCtrls = document.getElementsByClassName('vol');
        for(let i = 0; i < volCtrls.length; i++){
            volCtrls[i].addEventListener("input", (e) => {
                gainNodes[i].gain.linearRampToValueAtTime(e.target.value, ctx.currentTime + 0.05);
            })
        } 

        const freqCtrls = document.getElementsByClassName('freq');
        for(let i = 0; i < freqCtrls.length; i++){
            freqCtrls[i].addEventListener("input", (e) => {
                oscillators[i].frequency.linearRampToValueAtTime(e.target.value, ctx.currentTime + 0.05);
            })
        } 

        const shapeCtrls = document.getElementsByClassName('shape');
        for(let i = 0; i < shapeCtrls.length; i++){
            shapeCtrls[i].addEventListener("change", (e) => {
                oscillators[i].type = e.target.value;
            })
        }
        
        const filterCtrls = document.getElementsByClassName('filter-type');
        const filterCutOffCtrls = document.getElementsByClassName('cut-off-freq');
        for(let i = 0; i < filterCtrls.length; i++){
            filterCtrls[i].addEventListener("change", (e) => {
                filters[i].type = e.target.value;
                filters[i].frequency.setValueAtTime(filterCutOffCtrls[i].value, ctx.currentTime + 0.05);
            })
            filterCutOffCtrls[i].addEventListener("input", (e) => {
                filters[i].type = filterCtrls[i].value;
                filters[i].frequency.setValueAtTime(e.target.value, ctx.currentTime + 0.05);
            })
        }

        const panCtrls = document.getElementsByClassName('pan');
        for(let i = 0; i < panCtrls.length; i++){
            panCtrls[i].addEventListener("input", (e) => {
                stereoPannerNodes[i].pan.setValueAtTime(e.target.value, ctx.currentTime + 0.05);
            })
        }

        const qCtrls = document.getElementsByClassName('q');
        for(let i = 0; i < qCtrls.length; i++){
            qCtrls[i].addEventListener("input", (e) => {
                filters[i].Q.value = e.target.value;
            })
        }

        const shaperCtrls1 = document.getElementsByClassName('input-1');
        const shaperCtrls2 = document.getElementsByClassName('input-2');
        for(let i = 0; i < shaperCtrls1.length; i++){
            shaperCtrls1[i].addEventListener("input", (e) => {
                let curve = new Float32Array([e.target.value, shaperCtrls2[i].value]);
                waveShaperNodes[i].curve = curve;
            })
        }
        for(let i = 0; i < shaperCtrls1.length; i++){
            shaperCtrls2[i].addEventListener("input", (e) => {
                let curve = new Float32Array([shaperCtrls1[i].value, e.target.value]);
                waveShaperNodes[i].curve = curve;
            })
        }

        const delayCtrls = document.getElementsByClassName('delay');
        for(let i = 0; i < delayCtrls.length; i++){
            delayCtrls[i].addEventListener("input", (e) => {
                delayNodes[i].delayTime.linearRampToValueAtTime(e.target.value, ctx.currentTime + 0.05);
            })
        }

        // LFOs
        const lfos = document.querySelectorAll('.lfo');
        let lfoOscillators = [];
        let lfoGainNodes = [];

        lfos.forEach((module, i) => {
            const connectBtn = module.querySelector('button[class="connect"]');
            const disconnectBtn = module.querySelector('button[class="disconnect"]');

            lfoOscillators[i] = ctx.createOscillator();
            lfoGainNodes[i] = ctx.createGain();

            lfoOscillators[i].frequency.setValueAtTime(5, ctx.currentTime); 
            lfoGainNodes[i].gain.setValueAtTime(50, ctx.currentTime);

            connectBtn.addEventListener('click', function () {
                const modulationVal = module.querySelector('input[type="range"]').value;
                const checkboxes = module.querySelectorAll('input[type="checkbox"]:checked');
                const modulationParam = module.querySelector('select.ctrl-param').value;

                checkboxes.forEach(checkbox => {
                    const channelIndex = parseInt(checkbox.value - 1);

                    switch(modulationParam){
                        case 'gain':
                                lfoGainNodes[i].gain.setValueAtTime(modulationVal, ctx.currentTime); 
                                lfoGainNodes[i].connect(gainNodes[channelIndex].gain);

                                lfoOscillators[i].connect(lfoGainNodes[i]);
                                lfoOscillators[i].start();
                            break;
                        case 'frequency':
                                lfoGainNodes[i].gain.setValueAtTime(modulationVal, ctx.currentTime); 
                                lfoGainNodes[i].connect(oscillators[channelIndex].frequency);

                                lfoOscillators[i].connect(lfoGainNodes[i]);
                                lfoOscillators[i].start();
                            break;
                        case 'pan':
                                lfoGainNodes[i].gain.setValueAtTime(modulationVal, ctx.currentTime); 
                                lfoGainNodes[i].connect(stereoPannerNodes[channelIndex].pan);

                                lfoOscillators[i].connect(lfoGainNodes[i]);
                                lfoOscillators[i].start();
                            break;
                        case 'q':
                                lfoGainNodes[i].gain.setValueAtTime(modulationVal, ctx.currentTime); 
                                lfoGainNodes[i].connect(filters[channelIndex].Q);

                                lfoOscillators[i].connect(lfoGainNodes[i]);
                                lfoOscillators[i].start();
                        break;
                    }
                });
            });

            disconnectBtn.addEventListener('click', function () {
                lfoOscillators[i].stop();
            })

            });

    </script>
</body>
</html>